"use strict";(self.webpackChunkreact_widget_template=self.webpackChunkreact_widget_template||[]).push([[421],{5362:(e,s,t)=>{t(5043),t(2725),t(579)},1584:(e,s,t)=>{t.d(s,{A:()=>p});var o=t(3003),a=t(9379),n=t(6047);const r=async(e,s)=>{let t={CAAtt:[]};console.log("We are into Search CA Details");try{var o;const r=await(0,n.fV)(),l=async e=>new Promise(((t,o)=>{r.authenticatedRequest(e,{method:"GET",headers:s,type:"json",onComplete:e=>{console.log("Received response:",e),t(e)},onFailure:e=>{console.error("Request failed:",e),o(e)}})}));let i="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/changeaction/search?$searchStr=name:".concat(e);const c=null===(o=(await l(i)).changeAction[0])||void 0===o?void 0:o.identifier;if(console.log("Response From 1st Call",c),c){const e="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/changeaction/".concat(c,"?$fields=proposedChanges,flowDown"),s=await l(e);if(console.log("Response From 2nd Call",s),s){for(const e of s.isFlowDownOf||[])if("Change Action"===e.type){const s="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/changeaction/".concat(e.identifier,"?$fields=proposedChanges,flowDown");try{const e=await l(s);console.log("Response From 3rd Call",e),e&&t.CAAtt.push({CATitle:e.title,CAState:e.state})}catch(a){console.error("Error fetching parent CA data:",a)}}t.MCOState=s.state,t.MCOTitle=s.title}}return console.log("Final CA Details",t),t}catch(a){throw console.error("Error in SearchCA:",a),a}};var l=t(5645),i=(t(5043),t(3277)),c=t(2725),d=t(2268);const p=()=>{const{showErrorToast:e}=(0,c.A)(),s=(0,o.wA)();let t=window.widget.getValue("email");console.log("Email in usePlantAssignment:",t);return{handlePlantAssignment:async(o,c,p,u)=>{try{s((0,l.Ve)(!0));const m=await(0,d.I)();if(m){console.log("[UsePlantAssignment] Headers are",m);const e=await(async(e,s,t)=>{try{console.log("[UserGroup Status] ProductId: ",s);const o=await(0,n.fV)();let r="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/sharing/getSharing";const l=await new Promise(((t,n)=>{o.authenticatedRequest(r,{method:"POST",headers:(0,a.A)((0,a.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify({data:[{objectID:s}]}),type:"json",onComplete:t,onFailure:n})}));console.log("[Assigned Plant Service] Data received:",l);let i=[],c={groups:[]};if(l&&(l.results.forEach((e=>{e.sharings.userGroups.forEach((e=>{"Can Edit"===e.access&&c.groups.push({uri:e.userGroupID.replace(/[<>]/g,"")})}))})),c.groups.length>0)){let e="https://oi000186152-us1-usersgroup.3dexperience.3ds.com/3drdfpersist/resources/v1/usersgroup/groups?select=uri,members,title";const s=await new Promise(((s,t)=>{o.authenticatedRequest(e,{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(c),type:"json",onComplete:s,onFailure:t})}));console.log("Group Response is:",s),s&&(i=s.groups.filter((e=>e.members.includes(t))).map((e=>e.title)))}return console.log("[UserGroup Status] User Groups:",i),i}catch(o){throw console.error("[UserGroup Status] Error occurred:",o),o}})(m,p,t);console.log("[Plant Assignment] User Groups:",e);let i=[...e,o];if(console.log("[Use Plant Assignment] All CollabSpaces:",i),i){const e=await(async(e,s)=>{try{let t=[];console.log("[All Plant Service] CollabSpaces: ",e),console.log("[All Plant Service] headers: ",s);const o=await(0,n.fV)(),a=async e=>new Promise(((t,a)=>{o.authenticatedRequest(e,{method:"GET",headers:s,type:"json",onComplete:e=>{console.log("Received response:",e),t(e)},onFailure:e=>{console.error("Request failed:",e),a(e)}})})),r=e.map((async e=>{try{var s,o;const i="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslib/dslib:Library/search?$searchStr=".concat(e),c=null===(s=(await a(i)).member)||void 0===s||null===(o=s.find((s=>s.title===e)))||void 0===o?void 0:o.id;if(console.log("[All Plant Service] Library id is:",c),c){const e="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslib/dslib:Library/".concat(c,"?$mask=dslib:ExpandClassifiableClassesMask"),s=await a(e),{member:o}=s;if(o&&o.length>0){var n,r;console.log("[Library Data Service] Member found:",o);const e=null===(n=o[0])||void 0===n?void 0:n.ChildClasses;if((null===e||void 0===e||null===(r=e.member)||void 0===r?void 0:r.length)>0){var l;const s=null===(l=e.member[0].ChildClasses)||void 0===l?void 0:l.member;if(s&&s.length>0){const e=s.filter((e=>!t.some((s=>s.id===e.id))));t=[...t,...e]}}}}}catch(i){throw console.error("Error processing group:",e,i),i}}));return await Promise.all(r),t}catch(t){throw console.error("[All Plant Service] Error occurred:",t),t}})(i,m);if(console.log("[Use Plant Assignment] All Plants are:",e),e){const t=await(async(e,s,t)=>{try{console.log("[Assigned Plant Service] Plant Members:",e);const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslib/dslib:ClassifiedItem/".concat(t,"?$mask=dslib:ClassificationAttributesMask"),a=await(0,n.fV)(),l=await new Promise(((e,t)=>{a.authenticatedRequest(o,{method:"GET",headers:s,type:"json",onComplete:e,onFailure:t})}));console.log("[Assigned Plant Service] Data received:",l);let i=[],c=[],d=l.member[0].ClassificationAttributes.member;return await Promise.all(d.map((async t=>{console.log("Class Item is ",t);for(let o of e)if(t.ClassID===o.id){let e=o.title;e=e.replace("Plant","").replace(/\s+/g,"");let a={id:t.ClassID,title:o.title};const n=t.Attributes.map((t=>t.name.includes("FlowDownCA")&&t.value?r(t.value,s).then((e=>{if(e){console.log(e),a.MFGChange=null===e||void 0===e?void 0:e.MCOTitle,a.MFGStatus=null===e||void 0===e?void 0:e.MCOState;let s="",t="";e.CAAtt.forEach((e=>{s+=","+e.CATitle,t+=","+e.CAState})),a.Change=s.slice(1),a.ChangeStatus=t.slice(1)}})):(a[t.name.replace(e,"").trim()]=t.value,Promise.resolve())));await Promise.all(n),i=[...i,a],console.log("Initial Assigned Classes",i),console.log("Processed Object:",a)}}))),console.log("[Assigned Plant Service] Initial Assigned Classes:",i),c=e.filter((e=>!i.some((s=>s.id===e.id)))),console.log("uniqueInAllclasses--:",c),{success:!0,data:{plantData:{allPlants:e,initialAssignedPlants:i,uniquePlants:c}}}}catch(o){return console.error("[Object Details] Failed to fetch data:",o),{success:!1,error:o}}})(e,m,p);console.log("[Use Plant Assignment]: ",t),t.success?(s((0,l.Lq)(t.data.plantData)),s((0,l.lL)(m))):console.error("Failed to fetch plant data")}else console.warn("[Use All Plants] There are no Plants")}else console.warn("[Use All Plants] There are no CollabSpace");let d={};console.log("Type Before:",u),d="Raw_Material"===u?{success:!0,data:[]}:await(async(e,s)=>{let t="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dseng/dseng:EngItem/";t+=s,t+="/expand";let o={expandDepth:1,type_filter_bo:["VPMReference"],type_filter_rel:["VPMInstance"]};try{console.log("[SearchCAService] ProductId is:",s);const r=await(0,n.fV)(),l=(s,t,o)=>new Promise(((n,l)=>{r.authenticatedRequest(s,{method:t,headers:(0,a.A)((0,a.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(o),type:"json",onComplete:e=>{console.log("Received response:",e),n(e)},onFailure:e=>{console.error("Request failed:",e),l(e)}})})),i=await l(t,"POST",o);console.log("[Get CA Details Service] Data received:",i);const{member:c}=i;if(c){let e=i.member.filter((e=>("VPMReference"===e.type||"Raw_Material"===e.type)&&e.id!==s)).map((e=>({id:e.id,type:e.type,name:e.title,state:e.state})));return e.length>0&&await Promise.all(e.map((async e=>{if("released"===e.state.toLowerCase()){let s="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslib/dslib:ClassifiedItem/".concat(e.id,"?$mask=dslib:ClassificationAttributesMask");const t=await l(s,"GET","");console.log("classResponse->",t);const o=t.member.flatMap((e=>{var s;return null!==(s=e.ClassificationAttributes)&&void 0!==s&&s.member?e.ClassificationAttributes.member.map((e=>e.ClassID)):[]}));e.classes=o}}))),{success:!0,data:e}}}catch(r){return console.error("Error while Fetching",r),{success:!1,data:[],error:r}}})(m,p),console.log("Type After:",u),console.log("[Use All Plants] Product Childrens",d),d.success&&s((0,l.VG)(d.data));const h=await(async(e,s,t)=>{let o=!1,r=[];const l="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/enorelnav/v2/navigate/setPreferences";let i={widgetId:"ENORIPE_Relations_Preview_2751_2038-15:33:22",relations:["caproposedwhere_from"],allRelationsMode:!1,publicationsMode:!1,computeWithInstances:!1,attributesForView:["ds6w:status","ds6w:type","ds6w:identifier"],label:"ENXENG_AP-e1331143-1734517777960",lang:"en",ghostMode:!1},c={widgetId:"ENORIPE_Relations_Preview_2751_2038-15:33:22",responseMode:"objectsByPatterns",label:"ENXENG_AP-e1331143-1734517780491",ids:[s]};try{console.log("[Get CA Details] Product ID:",s);const d=await(0,n.fV)(),p=await new Promise(((s,t)=>{d.authenticatedRequest(l,{method:"POST",headers:(0,a.A)((0,a.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(i),type:"json",onComplete:s,onFailure:t})}));if(console.log("[Get CA Details Service] Data received:",p),"OK"===p.status){const n=await new Promise(((s,t)=>{d.authenticatedRequest("https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/enorelnav/v2/navigate/getEcosystem",{method:"POST",headers:(0,a.A)((0,a.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(c),type:"json",onComplete:s,onFailure:t})}));console.log("[Get CA Details Service] Data received:",n),n.objectsByPatterns.caproposedwhere_from&&await Promise.all(n.objectsByPatterns.caproposedwhere_from.map((async a=>{if("Complete"!==a["ds6w:status"].slice(14)){let n="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/changeaction/".concat(a.id,"?$fields=proposedChanges,flowDown");const l=await new Promise(((s,t)=>{d.authenticatedRequest(n,{method:"GET",headers:e,type:"json",onComplete:s,onFailure:t})}));Array.isArray(l.proposedChanges)&&l.proposedChanges.forEach((e=>{r.push({identifier:e.where.identifier,action:e.whats[0].what})})),o="released"!==t.toLowerCase()||r.some((e=>e.identifier===s&&"Modify"===e.action))}})))}else console.error("Unable to Fetch the ");return console.log("Status is coming inside 7"),console.log("Response Object is:",o),{success:!0,data:o,proposedChanges:r}}catch(d){throw console.error("Failed Request:",{url:l,headers:e,body:i,error:d}),d}})(m,p,c);return console.log("[Use All Plants] Get CA Details",h),h.success&&(s((0,l.ug)(h.data)),s((0,l.aB)(h.proposedChanges))),void console.log("[Plant Assignment] All Services Executed Successfully")}e(i.rK)}catch(m){throw console.error("[Plant Assignment] Error:",m),s((0,l.Ve)(!1)),m}finally{s((0,l.Ve)(!1))}}}}},2268:(e,s,t)=>{t.d(s,{I:()=>a});var o=t(6047);const a=async()=>{try{let e=window.widget.getValue("Credentials");const s=await(0,o.fV)();console.log("Security Context is:",e);const t="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/application/CSRF?tenant=OI000186152",a=await new Promise(((e,o)=>{s.authenticatedRequest(t,{method:"GET",type:"json",onComplete:e,onFailure:o})})),n=a.csrf.name,r=a.csrf.value,l="SecurityContext",i=e;return{[n]:r,[l]:i}}catch(e){return void console.error("[CSRF] Failed to fetch token:",e)}}}}]);
//# sourceMappingURL=421.19a4da0f.chunk.js.map